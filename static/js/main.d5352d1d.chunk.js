(this["webpackJsonpvirtual-background"]=this["webpackJsonpvirtual-background"]||[]).push([[0],{344:function(e,t){},345:function(e,t){},353:function(e,t){},356:function(e,t){},357:function(e,t){},358:function(e,t,n){"use strict";n.r(t);var r=n(21),a=n(409),o=n(5),i=n.n(o),c=n(52),u=n.n(c),s=n(55),l=n(47),f=n(6),d=n(400),g=n(412),m=n(417),b=n(402),p=n(403),j=n(361),v=n(296),h=n.n(v),x=n(297),O=n.n(x),_=n(4),C=n.n(_),E=n(12);function R(e,t,n){var r=Math.min(t,n),a=(t-r)/2,o=(n-r)/2,i=document.createElement("canvas");return i.width=63,i.height=63,i.getContext("2d").drawImage(e,a,o,r,r,0,0,i.width,i.height),new Promise((function(e){return i.toBlob((function(t){return e(t)}))}))}var T=function(e){var t=Object(o.useState)(),n=Object(f.a)(t,2),r=n[0],a=n[1];return Object(o.useEffect)((function(){var t=new Image;t.src=e,t.onload=Object(E.a)(C.a.mark((function e(){var n;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R(t,t.naturalWidth,t.naturalHeight);case 2:n=e.sent,a(URL.createObjectURL(n));case 4:case"end":return e.stop()}}),e)})))}),[e]),[r,function(){return URL.revokeObjectURL(r)}]},F=n(401),y=n(25),k=n(396);var A=Object(d.a)((function(e){return Object(g.a)({root:{padding:0,minWidth:e.spacing(7)+2,height:e.spacing(7)+2,width:e.spacing(7)+2,marginRight:e.spacing(1),marginBottom:e.spacing(1),border:"2px solid transparent",alignItems:"stretch",transitionProperty:"transform, border-color",transitionDuration:"".concat(e.transitions.duration.shorter,"ms"),transitionTimingFunction:e.transitions.easing.easeInOut,"&:hover":{transform:"scale(1.125)"}},active:{borderColor:e.palette.primary.main,transform:"scale(1.125)"}})})),S=function(e){var t=A();return Object(r.jsx)(k.a,{className:Object(y.a)(t.root,e.active&&t.active),disabled:e.disabled,onClick:e.onClick,children:e.children})};var w=Object(d.a)((function(e){return Object(g.a)({scalableContent:{width:"calc(100% + 2px)",height:"calc(100% + 2px)",margin:-1,borderRadius:e.shape.borderRadius},image:{objectFit:"cover"}})})),U=function(e){var t=w();return Object(r.jsxs)(S,{active:!!e.thumbnailUrl&&e.active,disabled:!e.thumbnailUrl,onClick:e.onClick,children:[e.thumbnailUrl?Object(r.jsx)("img",{className:Object(y.a)(t.scalableContent,t.image),src:e.thumbnailUrl,alt:"",onLoad:e.onLoad}):Object(r.jsx)(F.a,{className:t.scalableContent,variant:"rect"}),e.children]})};var P=function(e){var t=T(e.imageUrl),n=Object(f.a)(t,2),a=n[0],o=n[1];return Object(r.jsx)(U,{thumbnailUrl:a,active:e.active,onClick:e.onClick,onLoad:o})};var L=Object(d.a)((function(e){return Object(g.a)({root:{width:"100%",height:"100%",borderWidth:1,borderStyle:"solid",borderColor:"rgba(0, 0, 0, 0.23)",borderRadius:e.shape.borderRadius,margin:-1,boxSizing:"content-box",display:"flex",justifyContent:"center",alignItems:"center"}})})),M=function(e){var t=L();return Object(r.jsx)(S,{active:e.active,onClick:e.onClick,children:Object(r.jsx)("div",{className:t.root,children:e.children})})},I=["architecture-5082700_1280","porch-691330_1280","saxon-switzerland-539418_1280","shibuyasky-4768679_1280"].map((function(e){return"".concat("/virtual-background","/backgrounds/").concat(e,".jpg")}));var B=Object(d.a)((function(e){return Object(g.a)({root:{flex:1}})})),D=function(e){var t=B();return Object(r.jsx)(b.a,{className:t.root,children:Object(r.jsxs)(p.a,{children:[Object(r.jsx)(j.a,{gutterBottom:!0,variant:"h6",component:"h2",children:"Background"}),Object(r.jsx)(M,{active:"none"===e.config.type,onClick:function(){return e.onChange({type:"none"})},children:Object(r.jsx)(h.a,{})}),Object(r.jsx)(M,{active:"blur"===e.config.type,onClick:function(){return e.onChange({type:"blur"})},children:Object(r.jsx)(O.a,{})}),I.map((function(t){return Object(r.jsx)(P,{imageUrl:t,active:t===e.config.url,onClick:function(){return e.onChange({type:"image",url:t,image:Object.assign(new Image,{src:t})})}},t)})),Object(r.jsx)(m.a,{label:"Image URL",variant:"outlined",fullWidth:!0,margin:"normal",value:e.config.url||"",onChange:function(t){return e.onChange({type:"image",url:t.target.value,image:Object.assign(new Image,{src:t.target.value,crossOrigin:"Anonymous"})})}})]})})},N=n(406),W=n(407),X=n(413),G=n(415),H=n(410),V=n(414),Y=n(411);var z=Object(d.a)((function(e){return Object(g.a)({lightWrapping:{display:"flex",alignItems:"center"},formControl:{marginTop:e.spacing(2),marginBottom:e.spacing(1),marginRight:e.spacing(2),minWidth:160}})})),q=function(e){var t=z();function n(t,n){e.onChange(Object(l.a)(Object(l.a)({},e.config),{},{jointBilateralFilter:Object(l.a)(Object(l.a)({},e.config.jointBilateralFilter),{},{sigmaSpace:n})}))}return Object(r.jsx)(b.a,{children:Object(r.jsxs)(p.a,{children:[Object(r.jsx)(j.a,{gutterBottom:!0,variant:"h6",component:"h2",children:"Post-processing"}),"webgl2"===e.pipeline?Object(r.jsxs)(i.a.Fragment,{children:[Object(r.jsx)(j.a,{gutterBottom:!0,children:"Joint bilateral filter"}),Object(r.jsxs)(j.a,{variant:"body2",children:["Sigma space (",e.config.jointBilateralFilter.sigmaSpace,")"]}),Object(r.jsx)(V.a,{value:e.config.jointBilateralFilter.sigmaSpace,min:0,max:10,step:.1,valueLabelDisplay:"auto",onChange:n}),Object(r.jsxs)(j.a,{variant:"body2",children:["Sigma color (",e.config.jointBilateralFilter.sigmaColor,")"]}),Object(r.jsx)(V.a,{value:e.config.jointBilateralFilter.sigmaColor,min:0,max:1,step:.01,valueLabelDisplay:"auto",onChange:function(t,n){e.onChange(Object(l.a)(Object(l.a)({},e.config),{},{jointBilateralFilter:Object(l.a)(Object(l.a)({},e.config.jointBilateralFilter),{},{sigmaColor:n})}))}}),Object(r.jsx)(j.a,{gutterBottom:!0,children:"Background"}),Object(r.jsxs)(j.a,{variant:"body2",children:["Coverage (",e.config.coverage.join(" - "),")"]}),Object(r.jsx)(V.a,{value:e.config.coverage,min:0,max:1,step:.01,valueLabelDisplay:"auto",onChange:function(t,n){e.onChange(Object(l.a)(Object(l.a)({},e.config),{},{coverage:n}))}}),Object(r.jsxs)(j.a,{variant:"body2",gutterBottom:!0,children:["Light wrapping (",e.config.lightWrapping,")"]}),Object(r.jsxs)("div",{className:t.lightWrapping,children:[Object(r.jsxs)(N.a,{className:t.formControl,variant:"outlined",children:[Object(r.jsx)(X.a,{children:"Blend mode"}),Object(r.jsxs)(H.a,{label:"Blend mode",value:e.config.blendMode,onChange:function(t){e.onChange(Object(l.a)(Object(l.a)({},e.config),{},{blendMode:t.target.value}))},children:[Object(r.jsx)(G.a,{value:"screen",children:"Screen"}),Object(r.jsx)(G.a,{value:"linearDodge",children:"Linear dodge"})]})]}),Object(r.jsx)(V.a,{value:e.config.lightWrapping,min:0,max:1,step:.01,valueLabelDisplay:"auto",onChange:function(t,n){e.onChange(Object(l.a)(Object(l.a)({},e.config),{},{lightWrapping:n}))}})]})]}):Object(r.jsxs)(i.a.Fragment,{children:[Object(r.jsx)(W.a,{label:"Smooth segmentation mask",control:Object(r.jsx)(Y.a,{color:"primary",checked:e.config.smoothSegmentationMask,onChange:function(t){e.onChange(Object(l.a)(Object(l.a)({},e.config),{},{smoothSegmentationMask:t.target.checked}))}})}),Object(r.jsx)(W.a,{label:"Use Image Layer for background",control:Object(r.jsx)(Y.a,{color:"primary",checked:e.config.useImageLayer,onChange:function(t){e.onChange(Object(l.a)(Object(l.a)({},e.config),{},{useImageLayer:t.target.checked}))}})}),Object(r.jsxs)(j.a,{variant:"body2",children:["Blur radius (",e.config.jointBilateralFilter.sigmaSpace,")"]}),Object(r.jsx)(V.a,{value:e.config.jointBilateralFilter.sigmaSpace,min:4,max:10,step:1,valueLabelDisplay:"auto",onChange:n})]})]})})},K={"360p":["",[640,360],0],"144hd":["_segm_hd_gpu_v1093",[256,144],1],"144v3":["segm_full_sparse_v1008",[256,144],1],"96v3":["segm_lite_v1082",[160,96],1],"144v2":["segm_full_v679",[256,144],2],"96v2":["segm_lite_v681",[160,96],2]};var J=Object(d.a)((function(e){return Object(g.a)({root:Object(s.a)({},e.breakpoints.only("md"),{gridColumnStart:2,gridRowStart:2}),formControls:{display:"flex",flexWrap:"wrap"},formControl:{marginTop:e.spacing(1),marginBottom:e.spacing(1),marginRight:e.spacing(2),minWidth:200,flex:1}})})),Q=function(e){var t=J();return Object(r.jsx)(b.a,{className:t.root,children:Object(r.jsxs)(p.a,{children:[Object(r.jsx)(j.a,{gutterBottom:!0,variant:"h6",component:"h2",children:"Segmentation"}),Object(r.jsxs)("div",{className:t.formControls,children:[Object(r.jsxs)(N.a,{className:t.formControl,variant:"outlined",children:[Object(r.jsx)(X.a,{children:"Model"}),Object(r.jsxs)(H.a,{label:"Model",value:e.config.model,onChange:function(t){var n=t.target.value,r=e.config.backend,a=e.config.inputResolution;"meet"===n?(r="wasm","360p"===a&&(a="144v2")):"bodyPix"===n&&(r="webgl",a="360p");var o=e.config.pipeline;"bodyPix"===n&&"webgl2"===o&&(o="canvas2dCpu"),e.onChange(Object(l.a)(Object(l.a)({},e.config),{},{model:n,backend:r,inputResolution:a,pipeline:o}))},children:[Object(r.jsx)(G.a,{value:"meet",children:"Meet"}),Object(r.jsx)(G.a,{value:"bodyPix",children:"BodyPix"})]})]}),Object(r.jsxs)(N.a,{className:t.formControl,variant:"outlined",children:[Object(r.jsx)(X.a,{children:"Backend"}),Object(r.jsxs)(H.a,{label:"Backend",value:e.config.backend,onChange:function(t){e.onChange(Object(l.a)(Object(l.a)({},e.config),{},{backend:t.target.value}))},children:[Object(r.jsx)(G.a,{value:"wasm",disabled:"bodyPix"===e.config.model,children:"WebAssembly"}),Object(r.jsx)(G.a,{value:"wasmSimd",disabled:"bodyPix"===e.config.model||!e.isSIMDSupported,children:"WebAssembly SIMD"}),Object(r.jsx)(G.a,{value:"webgl",disabled:"meet"===e.config.model,children:"WebGL"})]})]}),Object(r.jsxs)(N.a,{className:t.formControl,variant:"outlined",children:[Object(r.jsx)(X.a,{children:"Input resolution"}),Object(r.jsx)(H.a,{label:"Input resolution",value:e.config.inputResolution,onChange:function(t){e.onChange(Object(l.a)(Object(l.a)({},e.config),{},{inputResolution:t.target.value}))},children:Object.keys(K).sort((function(e,t){return parseInt(e,10)-parseInt(t,10)})).reverse().map((function(t){return Object(r.jsx)(G.a,{value:t,disabled:"meet"===e.config.model?"360p"===t:"360p"!==t,children:t},t)}))})]}),Object(r.jsxs)(N.a,{className:t.formControl,variant:"outlined",children:[Object(r.jsx)(X.a,{children:"Pipeline"}),Object(r.jsxs)(H.a,{label:"Pipeline",value:e.config.pipeline,onChange:function(t){e.onChange(Object(l.a)(Object(l.a)({},e.config),{},{pipeline:t.target.value}))},children:[Object(r.jsx)(G.a,{value:"webgl2",disabled:"bodyPix"===e.config.model,children:"WebGL 2"}),Object(r.jsx)(G.a,{value:"canvas2dCpu",children:"Canvas 2D + CPU"})]})]})]})]})})},Z=n(240),$=n.n(Z),ee=n(298),te=n.n(ee);var ne=function(e){var t=Object(o.useState)(),n=Object(f.a)(t,2),r=n[0],a=n[1];return Object(o.useEffect)((function(){var t=document.createElement("video");t.src=e,t.onloadedmetadata=function(){t.currentTime=t.duration/2},t.onseeked=Object(E.a)(C.a.mark((function e(){var n;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R(t,t.videoWidth,t.videoHeight);case 2:n=e.sent,a(URL.createObjectURL(n));case 4:case"end":return e.stop()}}),e)})))}),[e]),[r,function(){return URL.revokeObjectURL(r)}]};var re=Object(d.a)((function(e){return Object(g.a)({icon:{position:"absolute",bottom:0,right:0,color:e.palette.common.white}})})),ae=function(e){var t=re(),n=ne(e.videoUrl),a=Object(f.a)(n,2),o=a[0],i=a[1];return Object(r.jsx)(U,{thumbnailUrl:o,active:e.active,onClick:e.onClick,onLoad:i,children:Object(r.jsx)(te.a,{className:t.icon})})},oe=["girl-919048_1280","doctor-5871743_640","woman-5883428_1280"].map((function(e){return"".concat("/virtual-background","/images/").concat(e,".jpg")})),ie=["Dance - 32938","Doctor - 26732","Thoughtful - 35590"].map((function(e){return"".concat("/virtual-background","/videos/").concat(e,".mp4")}));var ce=Object(d.a)((function(e){return Object(g.a)({root:{flex:1}})})),ue=function(e){var t=ce();return Object(r.jsx)(b.a,{className:t.root,children:Object(r.jsxs)(p.a,{children:[Object(r.jsx)(j.a,{gutterBottom:!0,variant:"h6",component:"h2",children:"Source"}),Object(r.jsxs)(M,{active:"camera"===e.config.type&&360===e.config.resolution,onClick:function(){return e.onChange({type:"camera",resolution:360})},children:[Object(r.jsx)($.a,{}),"360"]},"360"),Object(r.jsxs)(M,{active:"camera"===e.config.type&&540===e.config.resolution,onClick:function(){return e.onChange({type:"camera",resolution:540})},children:[Object(r.jsx)($.a,{}),"540"]},"540"),Object(r.jsxs)(M,{active:"camera"===e.config.type&&720===e.config.resolution,onClick:function(){return e.onChange({type:"camera",resolution:720})},children:[Object(r.jsx)($.a,{}),"720"]},"720"),oe.map((function(t){return Object(r.jsx)(P,{imageUrl:t,active:t===e.config.url,onClick:function(){return e.onChange({type:"image",url:t})}},t)})),ie.map((function(t){return Object(r.jsx)(ae,{videoUrl:t,active:t===e.config.url,onClick:function(){return e.onChange({type:"video",url:t})}},t)})),Object(r.jsx)(m.a,{label:"Image URL",variant:"outlined",fullWidth:!0,margin:"normal",value:e.config.url||"",onChange:function(t){return e.onChange({type:"image",url:t.target.value})}})]})})},se=n(416),le=n(360);var fe=Object(d.a)((function(e){return Object(g.a)({root:{flex:1,position:"relative"},render:{position:"absolute",width:"100%",height:"100%",objectFit:"cover"},stats:{position:"absolute",top:0,right:0,left:0,textAlign:"center",backgroundColor:"rgba(0, 0, 0, 0.48)",color:e.palette.common.white},playback:{position:"absolute",width:"100%",height:"100%",objectFit:"cover"}})})),de=function(e){var t=fe(),n=Object(o.useRef)(null);return Object(o.useEffect)((function(){n.current&&(n.current.srcObject=e.streamPlayback&&e.streamPlayback.canvasStream)}),[e.streamPlayback]),Object(r.jsxs)("div",{className:t.root,children:[Object(r.jsx)("video",{ref:n,className:t.playback,autoPlay:!0,playsInline:!0,controls:!1,muted:!0}),Object(r.jsx)(j.a,{className:t.stats,variant:"caption",children:"Video Output"})]})};function ge(e,t,n,r,a,o,i){var c=r.getContext("2d",{desynchronized:!0});c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="low";var u=Object(f.a)(K[n.inputResolution][1],2),s=u[0],l=u[1],d=s*l,g=new ImageData(s,l),m=document.createElement("canvas");m.width=s,m.height=l;var b,p=m.getContext("2d"),j=o._getInputMemoryOffset()/4,v=o._getOutputMemoryOffset()/4,h="filter"in CanvasRenderingContext2D.prototype;function x(){return(x=Object(E.a)(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("none"!==t.type&&O(),i(),"none"===t.type){e.next=9;break}if("bodyPix"!==n.model){e.next=8;break}return e.next=6,_();case 6:e.next=9;break;case 8:T();case 9:i(),F();case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){if(p.drawImage(e.htmlElement,0,0,e.width,e.height,0,0,s,l),"meet"===n.model)for(var t=p.getImageData(0,0,s,l),r=0;r<d;r++)for(var a=0;a<3;a++)o.HEAPF32[j+3*r+a]=t.data[4*r+a]/255}function _(){return R.apply(this,arguments)}function R(){return(R=Object(E.a)(C.a.mark((function e(){var t,n;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.segmentPerson(m);case 2:for(t=e.sent,n=0;n<d;n++)g.data[4*n+3]=t.data[n]?255:0;p.putImageData(g,0,0);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(){o._runInference();for(var e=K[n.inputResolution][2],t=0;t<d;t++){var r=void 0,a=v+t*e;if(1===e){r=o.HEAPF32[a]}else{var i=o.HEAPF32[a],c=o.HEAPF32[a+1],u=Math.max(i,c),s=Math.exp(i-u),l=Math.exp(c-u);r=l/(s+l)}g.data[4*t+3]=255*r}p.putImageData(g,0,0)}function F(){if(c.globalCompositeOperation="copy","none"!==t.type){var n;if(null===(n=b)||void 0===n?void 0:n.smoothSegmentationMask)switch(t.type){case"blur":c.filter="blur(8px)";break;case"image":c.filter="blur(4px)"}c.drawImage(m,0,0,s,l,0,0,e.width,e.height),c.globalCompositeOperation="source-in"}c.filter="none",c.drawImage(e.htmlElement,0,0),"none"!==t.type&&function(n){var a;if(c.globalCompositeOperation="destination-over",n){var o=b.jointBilateralFilter.sigmaSpace;if(h)c.filter="blur(".concat(o,"px)");else{var i=2;do{c.globalAlpha=i/2/o,c.drawImage(e.htmlElement,i,-i),c.drawImage(e.htmlElement,-i,-i),i*=2}while(i<=2*o);c.globalAlpha=1}c.drawImage(e.htmlElement,0,0)}else if(!(null===(a=b)||void 0===a?void 0:a.useImageLayer)){var u=t.image;u&&u.naturalHeight&&c.drawImage(u,0,0,r.width,r.height)}}("blur"===t.type)}return{render:function(){return x.apply(this,arguments)},updatePostProcessingConfig:function(e){b=e},cleanUp:function(){}}}var me=n(75),be=String.raw;function pe(e,t,n,r,a){var o=function(e,t,n){var r=e.createProgram();if(e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS))throw new Error("Could not link WebGL program: ".concat(e.getProgramInfoLog(r)));return r}(e,t,n),i=e.getAttribLocation(o,"a_position");e.enableVertexAttribArray(i),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);var c=e.getAttribLocation(o,"a_texCoord");return e.enableVertexAttribArray(c),e.bindBuffer(e.ARRAY_BUFFER,a),e.vertexAttribPointer(c,2,e.FLOAT,!1,0,0),o}function je(e,t,n){var r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Could not compile shader: ".concat(e.getShaderInfoLog(r)));return r}function ve(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.NEAREST,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.NEAREST,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,o),e.texStorage2D(e.TEXTURE_2D,1,t,n,r),i}function he(){return(he=Object(E.a)(C.a.mark((function e(t,n,r,a,o,i,c,u){var s;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.createBuffer(),t.bindBuffer(t.PIXEL_PACK_BUFFER,s),t.bufferData(t.PIXEL_PACK_BUFFER,u.byteLength,t.STREAM_READ),t.readPixels(n,r,a,o,i,c,0),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),e.next=7,xe(t,t.PIXEL_PACK_BUFFER,s,0,u);case 7:return t.deleteBuffer(s),e.abrupt("return",u);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(e,t,n,r,a,o,i){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(E.a)(C.a.mark((function e(t,n,r,a,o,i,c){var u,s;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0),t.flush(),e.next=4,_e(t,u);case 4:s=e.sent,t.deleteSync(u),s!==t.WAIT_FAILED&&(t.bindBuffer(n,r),t.getBufferSubData(n,a,o,i,c),t.bindBuffer(n,null));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _e(e,t){return new Promise((function(n){requestAnimationFrame((function r(){var a=e.clientWaitSync(t,0,0);a!==e.WAIT_FAILED?a!==e.TIMEOUT_EXPIRED?n(a):requestAnimationFrame(r):n(a)}))}))}function Ce(){var e=Object(me.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n    uniform sampler2D u_personMask;\n    uniform vec2 u_texelSize;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    const float offset[5] = float[](0.0, 1.0, 2.0, 3.0, 4.0);\n    const float weight[5] = float[](0.2270270270, 0.1945945946, 0.1216216216,\n      0.0540540541, 0.0162162162);\n\n    void main() {\n      vec4 centerColor = texture(u_inputFrame, v_texCoord);\n      float personMask = texture(u_personMask, v_texCoord).a;\n\n      vec4 frameColor = centerColor * weight[0] * (1.0 - personMask);\n\n      for (int i = 1; i < 5; i++) {\n        vec2 offset = vec2(offset[i]) * u_texelSize;\n\n        vec2 texCoord = v_texCoord + offset;\n        frameColor += texture(u_inputFrame, texCoord) * weight[i] *\n          (1.0 - texture(u_personMask, texCoord).a);\n\n        texCoord = v_texCoord - offset;\n        frameColor += texture(u_inputFrame, texCoord) * weight[i] *\n          (1.0 - texture(u_personMask, texCoord).a);\n      }\n      outColor = vec4(frameColor.rgb + (1.0 - frameColor.a) * centerColor.rgb, 1.0);\n    }\n  "]);return Ce=function(){return e},e}function Ee(){var e=Object(me.a)(["#version 300 es\n\n    in vec2 a_position;\n    in vec2 a_texCoord;\n\n    uniform float u_flipY;\n\n    out vec2 v_texCoord;\n\n    void main() {\n      // Flipping Y is required for the last pass when rendering to canvas\n      gl_Position = vec4(a_position * vec2(1.0, u_flipY), 0.0, 1.0);\n      v_texCoord = a_texCoord;\n    }\n  "]);return Ee=function(){return e},e}function Re(){var e=Object(me.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n    uniform sampler2D u_personMask;\n    uniform sampler2D u_background;\n    uniform vec2 u_coverage;\n    uniform float u_lightWrapping;\n    uniform float u_blendMode;\n\n    in vec2 v_texCoord;\n    in vec2 v_backgroundCoord;\n\n    out vec4 outColor;\n\n    vec3 screen(vec3 a, vec3 b) {\n      return 1.0 - (1.0 - a) * (1.0 - b);\n    }\n\n    vec3 linearDodge(vec3 a, vec3 b) {\n      return a + b;\n    }\n\n    void main() {\n      vec3 frameColor = texture(u_inputFrame, v_texCoord).rgb;\n      vec3 backgroundColor = texture(u_background, v_backgroundCoord).rgb;\n      float personMask = texture(u_personMask, v_texCoord).a;\n      float lightWrapMask = 1.0 - max(0.0, personMask - u_coverage.y) / (1.0 - u_coverage.y);\n      vec3 lightWrap = u_lightWrapping * lightWrapMask * backgroundColor;\n      frameColor = u_blendMode * linearDodge(frameColor, lightWrap) +\n        (1.0 - u_blendMode) * screen(frameColor, lightWrap);\n      personMask = smoothstep(u_coverage.x, u_coverage.y, personMask);\n      outColor = vec4(frameColor * personMask + backgroundColor * (1.0 - personMask), 1.0);\n    }\n  "]);return Re=function(){return e},e}function Te(){var e=Object(me.a)(["#version 300 es\n\n    uniform vec2 u_backgroundScale;\n    uniform vec2 u_backgroundOffset;\n\n    in vec2 a_position;\n    in vec2 a_texCoord;\n\n    out vec2 v_texCoord;\n    out vec2 v_backgroundCoord;\n\n    void main() {\n      // Flipping Y is required when rendering to canvas\n      gl_Position = vec4(a_position * vec2(1.0, -1.0), 0.0, 1.0);\n      v_texCoord = a_texCoord;\n      v_backgroundCoord = a_texCoord * u_backgroundScale + u_backgroundOffset;\n    }\n  "]);return Te=function(){return e},e}function Fe(){var e=Object(me.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n    uniform sampler2D u_segmentationMask;\n    uniform vec2 u_texelSize;\n    uniform float u_step;\n    uniform float u_radius;\n    uniform float u_offset;\n    uniform float u_sigmaTexel;\n    uniform float u_sigmaColor;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    float gaussian(float x, float sigma) {\n      float coeff = -0.5 / (sigma * sigma * 4.0 + 1.0e-6);\n      return exp((x * x) * coeff);\n    }\n\n    void main() {\n      vec2 centerCoord = v_texCoord;\n      vec3 centerColor = texture(u_inputFrame, centerCoord).rgb;\n      float newVal = 0.0;\n\n      float spaceWeight = 0.0;\n      float colorWeight = 0.0;\n      float totalWeight = 0.0;\n\n      // Subsample kernel space.\n      for (float i = -u_radius + u_offset; i <= u_radius; i += u_step) {\n        for (float j = -u_radius + u_offset; j <= u_radius; j += u_step) {\n          vec2 shift = vec2(j, i) * u_texelSize;\n          vec2 coord = vec2(centerCoord + shift);\n          vec3 frameColor = texture(u_inputFrame, coord).rgb;\n          float outVal = texture(u_segmentationMask, coord).a;\n\n          spaceWeight = gaussian(distance(centerCoord, coord), u_sigmaTexel);\n          colorWeight = gaussian(distance(centerColor, frameColor), u_sigmaColor);\n          totalWeight += spaceWeight * colorWeight;\n\n          newVal += spaceWeight * colorWeight * outVal;\n        }\n      }\n      newVal /= totalWeight;\n\n      outColor = vec4(vec3(0.0), newVal);\n    }\n  "]);return Fe=function(){return e},e}function ye(){var e=Object(me.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    void main() {\n      outColor = texture(u_inputFrame, v_texCoord);\n    }\n  "]);return ye=function(){return e},e}function ke(e,t,n,r,a,o){var i=be(ye()),c=o._getInputMemoryOffset()/4,u=Object(f.a)(K[a.inputResolution][1],2),s=u[0],l=u[1],d=s*l,g=je(e,e.FRAGMENT_SHADER,i),m=pe(e,t,g,n,r),b=e.getUniformLocation(m,"u_inputFrame"),p=ve(e,e.RGBA8,s,l),j=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,j),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,p,0);var v=new Uint8Array(4*d);return e.useProgram(m),e.uniform1i(b,0),{render:function(){e.useProgram(m),e.bindFramebuffer(e.FRAMEBUFFER,j),e.viewport(0,0,s,l),e.drawArrays(e.TRIANGLE_STRIP,0,4),function(e,t,n,r,a,o,i,c){he.apply(this,arguments)}(e,0,0,s,l,e.RGBA,e.UNSIGNED_BYTE,v);for(var t=0;t<d;t++){var n=c+3*t,r=4*t;o.HEAPF32[n]=v[r]/255,o.HEAPF32[n+1]=v[r+1]/255,o.HEAPF32[n+2]=v[r+2]/255}},cleanUp:function(){e.deleteFramebuffer(j),e.deleteTexture(p),e.deleteProgram(m),e.deleteShader(g)}}}function Ae(){var e=Object(me.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputSegmentation;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    void main() {\n      vec2 segmentation = texture(u_inputSegmentation, v_texCoord).rg;\n      float shift = max(segmentation.r, segmentation.g);\n      float backgroundExp = exp(segmentation.r - shift);\n      float personExp = exp(segmentation.g - shift);\n      outColor = vec4(vec3(0.0), personExp / (backgroundExp + personExp));\n    }\n  "]);return Ae=function(){return e},e}function Se(){var e=Object(me.a)(["#version 300 es\n\n    in vec2 a_position;\n    in vec2 a_texCoord;\n\n    out vec2 v_texCoord;\n\n    void main() {\n      gl_Position = vec4(a_position, 0.0, 1.0);\n      v_texCoord = a_texCoord;\n    }\n  "]);return Se=function(){return e},e}function we(e,t,n,r,a,o,i){var c=be(Se()),u=e.width,s=e.height,l=Object(f.a)(K[r.inputResolution][1],2),d=l[0],g=l[1],m=a.getContext("webgl2");if(!m)return{render:function(){var e=Object(E.a)(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),updatePostProcessingConfig:function(){},cleanUp:function(){}};var b=je(m,m.VERTEX_SHADER,c),p=m.createVertexArray();m.bindVertexArray(p);var j=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,j),m.bufferData(m.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),m.STATIC_DRAW);var v=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,v),m.bufferData(m.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),m.STATIC_DRAW);var h=m.createTexture();m.bindTexture(m.TEXTURE_2D,h),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);var x=ve(m,m.RGBA8,d,g),O=ve(m,m.RGBA8,u,s),_=ke(m,b,j,v,r,o),R=function(e,t,n,r,a,o,i){var c=be(Ae()),u=o._getOutputMemoryOffset()/4,s=Object(f.a)(K[a.inputResolution][1],2),l=s[0],d=s[1],g=je(e,e.FRAGMENT_SHADER,c),m=pe(e,t,g,n,r),b=e.getUniformLocation(m,"u_inputSegmentation"),p=ve(e,e.RG32F,l,d),j=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,j),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.useProgram(m),e.uniform1i(b,1),{render:function(){e.useProgram(m),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,p),e.texSubImage2D(e.TEXTURE_2D,0,0,0,l,d,e.RG,e.FLOAT,o.HEAPF32,u),e.bindFramebuffer(e.FRAMEBUFFER,j),e.viewport(0,0,l,d),e.drawArrays(e.TRIANGLE_STRIP,0,4)},cleanUp:function(){e.deleteFramebuffer(j),e.deleteTexture(p),e.deleteProgram(m),e.deleteShader(g)}}}(m,b,j,v,r,o,x),T=function(e,t,n,r,a,o,i,c){var u=be(Fe()),s=Object(f.a)(K[o.inputResolution][1],2),l=s[0],d=s[1],g=c.width,m=c.height,b=1/g,p=1/m,j=je(e,e.FRAGMENT_SHADER,u),v=pe(e,t,j,n,r),h=e.getUniformLocation(v,"u_inputFrame"),x=e.getUniformLocation(v,"u_segmentationMask"),O=e.getUniformLocation(v,"u_texelSize"),_=e.getUniformLocation(v,"u_step"),C=e.getUniformLocation(v,"u_radius"),E=e.getUniformLocation(v,"u_offset"),R=e.getUniformLocation(v,"u_sigmaTexel"),T=e.getUniformLocation(v,"u_sigmaColor"),F=e.createFramebuffer();function y(t){t*=Math.max(g/l,m/d);var n=Math.max(1,.66*Math.sqrt(t)),r=t,a=n>1?.5*n:0,o=Math.max(b,p)*t;e.useProgram(v),e.uniform1f(_,n),e.uniform1f(C,r),e.uniform1f(E,a),e.uniform1f(R,o)}function k(t){e.useProgram(v),e.uniform1f(T,t)}return e.bindFramebuffer(e.FRAMEBUFFER,F),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.useProgram(v),e.uniform1i(h,0),e.uniform1i(x,1),e.uniform2f(O,b,p),y(0),k(0),{render:function(){e.useProgram(v),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,a),e.bindFramebuffer(e.FRAMEBUFFER,F),e.viewport(0,0,g,m),e.drawArrays(e.TRIANGLE_STRIP,0,4)},updateSigmaSpace:y,updateSigmaColor:k,cleanUp:function(){e.deleteFramebuffer(F),e.deleteProgram(v),e.deleteShader(j)}}}(m,b,j,v,x,r,O,a),F="blur"===n.type?function(e,t,n,r,a){var o=be(Ee()),i=be(Ce()),c=a.width,u=a.height,s=1/c,l=1/u,f=je(e,e.VERTEX_SHADER,o),d=je(e,e.FRAGMENT_SHADER,i),g=pe(e,f,d,t,n),m=e.getUniformLocation(g,"u_inputFrame"),b=e.getUniformLocation(g,"u_personMask"),p=e.getUniformLocation(g,"u_texelSize"),j=e.getUniformLocation(g,"u_flipY"),v=ve(e,e.RGBA8,c,u),h=ve(e,e.RGBA8,c,u),x=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,x),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,v,0);var O=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,O),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,h,0),e.useProgram(g),e.uniform1i(m,0),e.uniform1i(b,1),{render:function(){e.useProgram(g),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r),e.uniform1f(j,1),e.activeTexture(e.TEXTURE0),e.uniform2f(p,0,l),e.bindFramebuffer(e.FRAMEBUFFER,x),e.viewport(0,0,c,u),e.drawArrays(e.TRIANGLE_STRIP,0,4);for(var t=0;t<9;t++)e.bindTexture(e.TEXTURE_2D,v),e.uniform2f(p,s,0),e.bindFramebuffer(e.FRAMEBUFFER,O),e.viewport(0,0,c,u),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.bindTexture(e.TEXTURE_2D,h),e.uniform2f(p,0,l),e.bindFramebuffer(e.FRAMEBUFFER,x),e.viewport(0,0,c,u),e.drawArrays(e.TRIANGLE_STRIP,0,4);e.bindTexture(e.TEXTURE_2D,v),e.uniform2f(p,s,0),e.uniform1f(j,-1),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,c,u),e.drawArrays(e.TRIANGLE_STRIP,0,4)},cleanUp:function(){e.deleteFramebuffer(O),e.deleteFramebuffer(x),e.deleteTexture(h),e.deleteTexture(v),e.deleteProgram(g),e.deleteShader(d),e.deleteShader(f)}}}(m,j,v,O,a):function(e,t,n,r,a,o){var i=be(Te()),c=be(Re()),u=o.width,s=o.height,l=u/s,f=je(e,e.VERTEX_SHADER,i),d=je(e,e.FRAGMENT_SHADER,c),g=pe(e,f,d,t,n),m=e.getUniformLocation(g,"u_backgroundScale"),b=e.getUniformLocation(g,"u_backgroundOffset"),p=e.getUniformLocation(g,"u_inputFrame"),j=e.getUniformLocation(g,"u_personMask"),v=e.getUniformLocation(g,"u_background"),h=e.getUniformLocation(g,"u_coverage"),x=e.getUniformLocation(g,"u_lightWrapping"),O=e.getUniformLocation(g,"u_blendMode");e.useProgram(g),e.uniform2f(m,1,1),e.uniform2f(b,0,0),e.uniform1i(p,0),e.uniform1i(j,1),e.uniform2f(h,0,1),e.uniform1f(x,0),e.uniform1f(O,0);var _=null;function C(t){_=ve(e,e.RGBA8,t.naturalWidth,t.naturalHeight,e.LINEAR,e.LINEAR),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.naturalWidth,t.naturalHeight,e.RGBA,e.UNSIGNED_BYTE,t);var n=0,r=0,a=t.naturalWidth,o=t.naturalHeight;a/o<l?(o=a/l,r=(t.naturalHeight-o)/2):(a=o*l,n=(t.naturalWidth-a)/2);var i=a/t.naturalWidth,c=o/t.naturalHeight;n/=t.naturalWidth,r/=t.naturalHeight,e.uniform2f(m,i,c),e.uniform2f(b,n,r)}return(null===a||void 0===a?void 0:a.complete)?C(a):a&&(a.onload=function(){C(a)}),{render:function(){e.useProgram(g),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r),null!==_&&(e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,_),e.uniform1i(v,2)),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,u,s),e.drawArrays(e.TRIANGLE_STRIP,0,4)},updateCoverage:function(t){e.useProgram(g),e.uniform2f(h,t[0],t[1])},updateLightWrapping:function(t){e.useProgram(g),e.uniform1f(x,t)},updateBlendMode:function(t){e.useProgram(g),e.uniform1f(O,"screen"===t?0:1)},cleanUp:function(){e.deleteTexture(_),e.deleteProgram(g),e.deleteShader(d),e.deleteShader(f)}}}(m,j,v,O,t,a);function y(){return(y=Object(E.a)(C.a.mark((function t(){return C.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:m.clearColor(0,0,0,0),m.clear(m.COLOR_BUFFER_BIT),m.activeTexture(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,h),m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,e.htmlElement),m.bindVertexArray(p),_.render(),i(),o._runInference(),i(),R.render(),T.render(),F.render();case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return{render:function(){return y.apply(this,arguments)},updatePostProcessingConfig:function(e){if(T.updateSigmaSpace(e.jointBilateralFilter.sigmaSpace),T.updateSigmaColor(e.jointBilateralFilter.sigmaColor),"none"===n.type){var t=F;t.updateCoverage([0,.9999]),t.updateLightWrapping(0)}else if("image"===n.type){var r=F;r.updateCoverage(e.coverage),r.updateLightWrapping(e.lightWrapping),r.updateBlendMode(e.blendMode)}},cleanUp:function(){F.cleanUp(),T.cleanUp(),R.cleanUp(),_.cleanUp(),m.deleteTexture(O),m.deleteTexture(x),m.deleteTexture(h),m.deleteBuffer(v),m.deleteBuffer(j),m.deleteVertexArray(p),m.deleteShader(b)}}}var Ue=function(){var e=Object(o.useState)(0),t=Object(f.a)(e,2),n=t[0],r=t[1],a=Object(o.useState)([]),i=Object(f.a)(a,2),c=i[0],u=i[1],s=Object(o.useRef)(0),l=Object(o.useRef)(0),d=Object(o.useRef)([]),g=Object(o.useRef)(0),m=Object(o.useRef)(0);return{fps:n,durations:c,beginFrame:Object(o.useCallback)((function(){l.current=performance.now()}),[]),addFrameEvent:Object(o.useCallback)((function(){var e=performance.now();d.current[g.current]=e-l.current,l.current=e,g.current++}),[]),endFrame:Object(o.useCallback)((function(){var e=performance.now();d.current[g.current]=e-l.current,m.current++,e>=s.current+1e3&&(r(1e3*m.current/(e-s.current)),u(d.current),s.current=e,m.current=0),g.current=0}),[])}};var Pe=function(e,t,n,r,a){var i=Object(o.useState)(null),c=Object(f.a)(i,2),u=c[0],s=c[1],l=Object(o.useRef)(null),d=Object(o.useRef)(null),g=Ue(),m=g.fps,b=g.durations,p=g.beginFrame,j=g.addFrameEvent,v=g.endFrame;return Object(o.useEffect)((function(){var o,i=!0,c=performance.now(),u=1e3/30,f="webgl2"===n.pipeline?we(e,l.current,t,n,d.current,a,j):ge(e,t,n,d.current,r,a,j);function g(){return m.apply(this,arguments)}function m(){return(m=Object(E.a)(C.a.mark((function e(){var t;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return");case 2:if(!((t=performance.now())-c>=u)){e.next=9;break}return c=t,p(),e.next=8,f.render();case 8:v();case 9:o=requestAnimationFrame(g);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return g(),console.log("Animation started:",e,t,n),s(f),function(){i=!1,cancelAnimationFrame(o),f.cleanUp(),console.log("Animation stopped:",e,t,n),s(null)}}),[e,t,n,r,a,s,p,j,v]),{pipeline:u,backgroundImageRef:l,canvasRef:d,fps:m,durations:b}};var Le=Object(d.a)((function(e){return Object(g.a)({root:{flex:1,position:"relative"},render:{position:"absolute",width:"100%",height:"100%",objectFit:"cover"},stats:{position:"absolute",top:0,right:0,left:0,textAlign:"center",backgroundColor:"rgba(0, 0, 0, 0.48)",color:e.palette.common.white}})})),Me=function(e){var t,n=Le(),a=Pe(e.sourcePlayback,e.backgroundConfig,e.segmentationConfig,e.bodyPix,e.tflite),i=a.pipeline,c=a.backgroundImageRef,u=a.canvasRef,s=a.fps,l=Object(f.a)(a.durations,3),d=l[0],g=l[1],m=l[2],b=e.onLoad;Object(o.useEffect)((function(){i&&i.updatePostProcessingConfig(e.postProcessingConfig)}),[i,e.postProcessingConfig]),Object(o.useEffect)((function(){b({canvasStream:u.current&&u.current.captureStream(30)})}),[b,u,e.postProcessingConfig,e.segmentationConfig]);var p=[["resize",d],["inference",g],["compose",m]];return Object(r.jsxs)("div",{className:n.root,children:["image"===e.backgroundConfig.type&&Object(r.jsx)("img",{ref:c,className:n.render,src:e.backgroundConfig.url,alt:"",hidden:!e.postProcessingConfig.useImageLayer||"webgl2"===e.segmentationConfig.pipeline}),Object(r.jsx)("canvas",{ref:u,className:n.render,width:e.sourcePlayback.width,height:e.sourcePlayback.height},e.segmentationConfig.pipeline),Object(r.jsxs)(j.a,{className:n.stats,variant:"caption",children:["".concat(null===(t=u.current)||void 0===t?void 0:t.height,"p ").concat(Math.round(s),"fps"),Object(r.jsx)("br",{}),"".concat(p.map((function(e){var t=Object(f.a)(e,2),n=t[0],r=t[1];return"".concat(n," ").concat(r&&r.toFixed(2).padStart(5,"0"),"ms")})).join(", "))]})]})},Ie=n(408),Be=n(299),De=n.n(Be);var Ne=Object(d.a)((function(e){var t;return Object(g.a)({root:(t={position:"relative",display:"flex",justifyContent:"center",alignItems:"center"},Object(s.a)(t,e.breakpoints.down("xs"),{width:0,overflow:"hidden"}),Object(s.a)(t,e.breakpoints.up("sm"),{flex:1,borderRightWidth:1,borderRightStyle:"solid",borderRightColor:e.palette.divider}),t),stats:{position:"absolute",top:0,right:0,left:0,textAlign:"center",backgroundColor:"rgba(0, 0, 0, 0.48)",color:e.palette.common.white},sourcePlayback:{position:"absolute",width:"100%",height:"100%",objectFit:"cover"}})})),We=function(e){var t=Ne(),n=Object(o.useState)(),a=Object(f.a)(n,2),i=a[0],c=a[1],u=Object(o.useState)(!1),s=Object(f.a)(u,2),l=s[0],d=s[1],g=Object(o.useState)(!1),m=Object(f.a)(g,2),b=m[0],p=m[1],v=Object(o.useRef)(null);return Object(o.useEffect)((function(){c(void 0),d(!0),p(!1),setTimeout((function(){return c(e.sourceConfig.url)}))}),[e.sourceConfig]),Object(o.useEffect)((function(){function t(){return(t=Object(E.a)(C.a.mark((function t(){var n,r;return C.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n={video:{height:{exact:e.sourceConfig.resolution}}},t.next=4,navigator.mediaDevices.getUserMedia(n);case 4:if(r=t.sent,!v.current){t.next=8;break}return v.current.srcObject=r,t.abrupt("return");case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),console.error("Error opening video camera.",t.t0);case 13:d(!1),p(!0);case 15:case"end":return t.stop()}}),t,null,[[0,10]])})))).apply(this,arguments)}if(v.current){var n=v.current.srcObject;n&&n instanceof MediaStream&&n.getVideoTracks().forEach((function(e){return e.stop()}))}"camera"===e.sourceConfig.type?function(){t.apply(this,arguments)}():v.current&&(v.current.srcObject=null)}),[e.sourceConfig]),Object(r.jsxs)("div",{className:t.root,children:[l&&Object(r.jsx)(Ie.a,{}),"image"===e.sourceConfig.type?Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("img",{className:t.sourcePlayback,src:i,hidden:l,crossOrigin:"anonymous",alt:"",onLoad:function(t){var n=t.target;e.onLoad({htmlElement:n,width:n.naturalWidth,height:n.naturalHeight}),d(!1)}}),Object(r.jsx)(j.a,{className:t.stats,variant:"caption",children:"Image Input"})]}):b?Object(r.jsx)(De.a,{fontSize:"large"}):Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("video",{ref:v,className:t.sourcePlayback,src:i,hidden:l,autoPlay:!0,playsInline:!0,controls:!1,muted:!0,loop:!0,onLoadedData:function(t){var n=t.target;e.onLoad({htmlElement:n,width:n.videoWidth,height:n.videoHeight}),d(!1)}}),Object(r.jsx)(j.a,{className:t.stats,variant:"caption",children:"Video Input"})]})]})};var Xe=Object(d.a)((function(e){var t,n=["".concat(e.spacing(52),"px"),"100vh - ".concat(e.spacing(2),"px")];return Object(g.a)({root:(t={minHeight:"calc(min(".concat(n.join(", "),"))"),display:"flex",overflow:"hidden"},Object(s.a)(t,e.breakpoints.up("md"),{gridColumnStart:1,gridColumnEnd:4}),Object(s.a)(t,e.breakpoints.up("lg"),{gridRowStart:1,gridRowEnd:4}),t),noOutput:{flex:1,display:"flex",justifyContent:"center",alignItems:"center"},avatar:{width:e.spacing(20),height:e.spacing(20)}})})),Ge=function(e){var t=Xe(),n=Object(o.useState)(),a=Object(f.a)(n,2),i=a[0],c=a[1],u=Object(o.useState)(),s=Object(f.a)(u,2),l=s[0],d=s[1];return Object(o.useEffect)((function(){c(void 0)}),[e.sourceConfig]),Object(r.jsxs)(le.a,{className:t.root,children:[Object(r.jsx)(We,{sourceConfig:e.sourceConfig,onLoad:c}),i&&e.bodyPix&&e.tflite?Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(Me,{sourcePlayback:i,backgroundConfig:e.backgroundConfig,segmentationConfig:e.segmentationConfig,postProcessingConfig:e.postProcessingConfig,bodyPix:e.bodyPix,tflite:e.tflite,onLoad:d}),Object(r.jsx)(de,{streamPlayback:l})]}):Object(r.jsx)("div",{className:t.noOutput,children:Object(r.jsx)(se.a,{className:t.avatar})})]})},He=n(300),Ve=n(320);var Ye=function(){var e=Object(o.useState)(),t=Object(f.a)(e,2),n=t[0],r=t[1];return Object(o.useEffect)((function(){function e(){return(e=Object(E.a)(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Loading TensorFlow.js and BodyPix segmentation model"),e.next=3,Ve.a();case 3:return e.t0=r,e.next=6,He.a();case 6:e.t1=e.sent,(0,e.t0)(e.t1),console.log("TensorFlow.js and BodyPix loaded");case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),n},ze=Promise.resolve();var qe=function(e){var t=Object(o.useState)(),n=Object(f.a)(t,2),r=n[0],a=n[1],i=Object(o.useState)(),c=Object(f.a)(i,2),u=c[0],s=c[1],l=Object(o.useState)(),d=Object(f.a)(l,2),g=d[0],m=d[1],b=Object(o.useState)(!1),p=Object(f.a)(b,2),j=p[0],v=p[1];return Object(o.useEffect)((function(){function e(){return(e=Object(E.a)(C.a.mark((function e(){var t;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return createTFLiteModule().then(a),e.prev=1,e.next=4,createTFLiteSIMDModule();case 4:t=e.sent,s(t),v(!0),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.warn("Failed to create TFLite SIMD WebAssembly module.",e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(o.useEffect)((function(){function t(){return(t=Object(E.a)(C.a.mark((function t(){var n,a,o,i,c,s;return C.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&(!j||u)&&(j||"wasmSimd"!==e.backend)&&"meet"===e.model){t.next=2;break}return t.abrupt("return");case 2:if(m(void 0),n="wasmSimd"===e.backend?u:r){t.next=6;break}throw new Error("TFLite backend unavailable: ".concat(e.backend));case 6:return a=K[e.inputResolution][0],console.log("Loading meet model:",a),t.next=10,fetch("".concat("/virtual-background","/models/").concat(a,".tflite"));case 10:if((o=t.sent).ok){t.next=13;break}throw new Error("TFLite model unavailable");case 13:return t.next=15,o.arrayBuffer();case 15:if(i=t.sent,console.log("Model buffer size:",i.byteLength),c=n._getModelBufferMemoryOffset(),console.log("Model buffer memory offset:",c),n.HEAPU8.set(new Uint8Array(i),c),s=n._loadModel(i.byteLength),console.log("_loadModel result:",s),0===s){t.next=24;break}return t.abrupt("return");case 24:console.log("Input memory offset:",n._getInputMemoryOffset()),console.log("Input dimension:",[n._getInputWidth(),n._getInputHeight()]),console.log("Input channels:",n._getInputChannelCount()),console.log("Output memory offset:",n._getOutputMemoryOffset()),console.log("Output height:",[n._getOutputWidth(),n._getOutputHeight()]),console.log("Output channels:",n._getOutputChannelCount()),m(n);case 31:case"end":return t.stop()}}),t)})))).apply(this,arguments)}ze=ze.then((function(){return function(){return t.apply(this,arguments)}()}))}),[r,u,j,e]),{tflite:g,isSIMDSupported:j}};var Ke=Object(d.a)((function(e){var t,n;return Object(g.a)({root:(t={display:"grid"},Object(s.a)(t,e.breakpoints.up("xs"),{margin:e.spacing(1),gap:e.spacing(1),gridTemplateColumns:"1fr"}),Object(s.a)(t,e.breakpoints.up("md"),{margin:e.spacing(2),gap:e.spacing(2),gridTemplateColumns:"repeat(2, 1fr)"}),Object(s.a)(t,e.breakpoints.up("lg"),{gridTemplateColumns:"repeat(3, 1fr)"}),t),resourceSelectionCards:{display:"flex",flexDirection:"column"},pick:(n={display:"flex",flexDirection:"column"},Object(s.a)(n,e.breakpoints.up("xs"),{gap:e.spacing(1)}),Object(s.a)(n,e.breakpoints.up("md"),{gap:e.spacing(2)}),n)})})),Je=function(){var e=Ke(),t=Object(o.useState)({type:"image",url:oe[0],resolution:360}),n=Object(f.a)(t,2),a=n[0],i=n[1],c=Object(o.useState)({type:"image",url:I[0],image:Object.assign(new Image,{src:I[0]})}),u=Object(f.a)(c,2),s=u[0],d=u[1],g=Object(o.useState)({model:"meet",backend:"wasm",inputResolution:"96v2",pipeline:"canvas2dCpu"}),m=Object(f.a)(g,2),b=m[0],p=m[1],j=Object(o.useState)({smoothSegmentationMask:!0,useImageLayer:!1,jointBilateralFilter:{sigmaSpace:1,sigmaColor:.1},coverage:[.5,.75],lightWrapping:.3,blendMode:"screen"}),v=Object(f.a)(j,2),h=v[0],x=v[1],O=Ye(),_=qe(b),C=_.tflite,E=_.isSIMDSupported;return Object(o.useEffect)((function(){p((function(e){return"wasm"===e.backend&&E?Object(l.a)(Object(l.a)({},e),{},{backend:"wasmSimd"}):e}))}),[E]),Object(o.useEffect)((function(){x((function(e){var t="canvas2dCpu"===b.pipeline?4:1;return Object(l.a)(Object(l.a)({},e),{},{jointBilateralFilter:Object(l.a)(Object(l.a)({},e.jointBilateralFilter),{},{sigmaSpace:t})})}))}),[b.pipeline]),Object(r.jsxs)("div",{className:e.root,children:[Object(r.jsx)(Ge,{sourceConfig:a,backgroundConfig:s,segmentationConfig:b,postProcessingConfig:h,bodyPix:O,tflite:C}),Object(r.jsxs)("div",{className:e.pick,children:[Object(r.jsx)(ue,{config:a,onChange:i}),Object(r.jsx)(D,{config:s,onChange:d})]}),Object(r.jsx)(Q,{config:b,isSIMDSupported:E,onChange:p}),Object(r.jsx)(q,{config:h,pipeline:b.pipeline,onChange:x})]})},Qe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,419)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),o(e),i(e)}))};u.a.render(Object(r.jsxs)(i.a.StrictMode,{children:[Object(r.jsx)(a.a,{}),Object(r.jsx)(Je,{})]}),document.getElementById("root")),Qe()}},[[358,1,2]]]);
//# sourceMappingURL=main.d5352d1d.chunk.js.map